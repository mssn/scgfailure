% Template for a CDF graph
%
% Author: Zengwen Yuan
% Version: 1.0  2017-03-08 init version
% Note: to use package fontspec,
% use XeLaTeX to compile

\documentclass{standalone}
\usepackage{siunitx}
% \usepackage{tikz}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
%\usepackage{verbatim}
\usepackage{tikz}
\usepackage{helvet,etoolbox}
%\usepackage{sansmath}
\usepackage[active,tightpage]{preview}
\PreviewEnvironment{tikzpicture}
\setlength\PreviewBorder{1pt}
\usetikzlibrary{patterns}
\usetikzlibrary{pgfplots.statistics}

\pgfplotsset{compat=newest}

%\usepackage{fontspec}
%\setmainfont[
%BoldFont={Arial Bold},
%ItalicFont={Arial Italic},
%BoldItalicFont={Arial Bold Italic}
%]{Arial}

%\AtBeginEnvironment{tikzpicture}{\sansmath}
%\AtEndEnvironment{tikzpicture}{\unsansmath}

% # user-study-sync-overhead-context-tx-v2.txt
%\pgfplotstableread{
%0   0
%1000   0.1
%5000   0.8
%10000   0.95
%20000   1
%}{\fakedata}

\makeatletter
\pgfplotsset{
my filter/.style args={every#1between#2and#3}{%
/pgfplots/x filter/.append code={%
\ifnum\coordindex<#2%
  % Nothing
\else% Did we pass #3?
  \ifnum\coordindex>#3%
    %Nothing
  \else% Ok filter is on, don't disturb \pgfmathresult for convenience
    \pgfmathsetmacro\temp{int(mod(\coordindex,#1))}%
    \ifnum0=\temp\relax% Are we on the nth point?
      % Yes do nothing let it pass
    \else% discard it
      \let\pgfmathresult\pgfutil@empty
    \fi%
  \fi%
\fi%
}}}
\makeatother



\pgfplotsset{
    compat=newest,
    legend image code/.code={
        \draw[mark repeat=2,mark phase=2]
        plot coordinates {
            (0cm,0cm)
            (0.3cm,0cm)        %% default is (0.3cm,0cm)
            (0.6cm,0cm)         %% default is (0.6cm,0cm)
        };%
    }
}

\makeatletter
\pgfplotsset{
	boxplot prepared from table/.code={
		\def\tikz@plot@handler{\pgfplotsplothandlerboxplotprepared}%
		\pgfplotsset{
			/pgfplots/boxplot prepared from table/.cd,
			#1,
		}
	},
	/pgfplots/boxplot prepared from table/.cd,
	table/.code={\pgfplotstablecopy{#1}\to\boxplot@datatable},
	row/.initial=0,
	make style readable from table/.style={
		#1/.code={
			\pgfplotstablegetelem{\pgfkeysvalueof{/pgfplots/boxplot prepared from table/row}}{##1}\of\boxplot@datatable
			\pgfplotsset{boxplot/#1/.expand once={\pgfplotsretval}}
		}
	},
	make style readable from table=lower whisker,
	make style readable from table=upper whisker,
	make style readable from table=lower quartile,
	make style readable from table=upper quartile,
	make style readable from table=median,
	make style readable from table=lower notch,
	make style readable from table=upper notch,
}
\makeatother

\pgfplotstableread{
	lw lq med  uq uw
2.3384694556 3.375492334 23.27705564 77.13367773 262.4175557599999
0.15761058120000002 0.268813959 0.690543385 1.285898756 3.6154741522
10000 10000 10000 10000 10000
0.4848741642 0.747280149 1.113574694 15.3422171 39.884332838000006
0.16482273949999998 0.53521534425 1.7451760915 4.121454476 61.03264
0.15819394400000003 0.42031118 0.9541285355 1.91815222575 6.730777212500005
}\datatable

\pgfplotstableread{
	lw lq med  uq uw
0.14191991530000003 0.47132873425 1.4975302314999999 2.3662283105 21.42436308149999
0.15761058120000002 0.268813959 0.690543385 1.285898756 3.6154741522
}\datatablea

\pgfplotstableread{
	lw lq med  uq uw
	0.4848741642 0.747280149 1.113574694 15.3422171 39.884332838000006
	2.3384694556 3.375492334 23.27705564 77.13367773 262.4175557599999
}\datatableb

\pgfplotstableread{
	lw lq med  uq uw
0.15819394400000003 0.42031118 0.9541285355 1.91815222575 6.730777212500005
10000 10000 10000 10000 10000
}\datatablec

\pgfplotstableread{
	x y
1	0.09565821
1	0.097053973
1	0.107565679
1	26.9677992
1	912.3566434
1	5327.046038
4.5	0.03842545
4.5	3.976389393
}\outlierdatatablea

\pgfplotstableread{
x y
2	0.309936841
2	56.24574333
5.5	0.549971095
5.5	1.753633351
5.5	2.306283022
5.5	384.0335124
5.5	415.262938
5.5	424.8931159
}\outlierdatatableb

\pgfplotstableread{
	x y
3	0.042212397
3	0.093291746
3	0.122460013
3	0.123644834
3	9.863732252
3	13.89789818
3	32.74433006
3	74.47285422
}\outlierdatatablec

% \definecolor{palette1}{RGB}{215,25,28}
% \definecolor{palette2}{RGB}{253,174,97}
% % \definecolor{palette3}{RGB}{255,255,191}
% \definecolor{palette3}{RGB}{208,28,139}
% \definecolor{palette4}{RGB}{184,225,134}
% % \definecolor{palette4}{RGB}{171,221,164}
% \definecolor{palette5}{RGB}{43,131,186}
% \definecolor{palette6}{RGB}{208,28,139}

% green -- blueish
% \definecolor{palette1}{RGB}{0,109,44}
% \definecolor{palette2}{RGB}{44,162,95}
% \definecolor{palette3}{RGB}{67,162,202}
% \definecolor{palette4}{RGB}{8,104,172}
% \definecolor{palette5}{RGB}{8,81,156}

%\definecolor{myred}{RGB}{202,0,32}
%\definecolor{myorange}{RGB}{244,165,130}
%\definecolor{myviolet}{RGB}{194,165,207}
%\definecolor{mycyan}{RGB}{146,197,222}
%\definecolor{myblue}{RGB}{5,113,176}
%\definecolor{mygreen}{RGB}{127,191,123}
%\definecolor{mytile}{RGB}{27,120,55}
%\definecolor{myblack}{RGB}{60,60,60}
%% \definecolor{palette3}{RGB}{247,247,247}

\definecolor{myblue}{HTML}{0070C0}
\definecolor{myred}{HTML}{C00000}
\definecolor{mypurple}{HTML}{7030A0}
\definecolor{mygreen}{HTML}{00B050}


% \documentclass{standalone}
\usepackage{pgfplots}
% Nice color sets, see see http://colorbrewer2.org/	
\usepgfplotslibrary{colorbrewer}
% initialize Set1-4 from colorbrewer (we're comparing 4 classes),
\pgfplotsset{compat = 1.15, cycle list/Set1-8} 
% Tikz is loaded automatically by pgfplots
\usetikzlibrary{pgfplots.statistics, pgfplots.colorbrewer} 
% provides \pgfplotstabletranspose
\usepackage{pgfplotstable}
\usepackage{filecontents}

\begin{document}

%\begin{tikzpicture}[font=\sffamily]
\begin{tikzpicture}
	
\begin{semilogyaxis}[
    %ymode = log,
    boxplot/draw direction=y,
    ymax    = 300,
    ymin    = 0.01,
    xmax    = 6,%12.5,
    xmin    = 0.5,
    width   =  4.5 cm,
    height  =  2.5 cm,
    scale only axis = true,
    xtick align = inside,
    % bar width   = 1pt,
    % enlarge x limits = auto,
    % xticklabel style = {
    %     font=\small,
    %     % at={(current axis.north west)},
    %     % rotate=-90,
    %     % xshift=-1ex,
    %     yshift = 2pt,
    % },
    tick label style={/pgf/number format/assume math mode=true},
    xtick = {1,2,3,4.5,5.5},
	%xticklabels = {T$_{D_2}$, A$_{D_2}$, T$_{D_1}$, A$_{D_1}$, V$_{D_1}$},
    xticklabels = {\textbf{A}, \textbf{T}, \textbf{V}, \textbf{A}, \textbf{T}},
    %ytick = {1, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 200, 300, 400},
    %yticklabels = {1, 10, , , , , , , , , 100, , , 400},
    ytick = {0.01, 0.1, 1, 10, 100}, 
	yticklabels = {1, 10, 100, 1000, 10000},  
    %ytick = {1, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 200, 300, 400},
    %yticklabels =   {1, 10, , , , , , , , , 100, , , 400},
    xticklabel style = {font=\small},
    %yticklabel style = {font=\small},
    boxplot/variable width,
    boxplot/box extend=0.9,
    % % xticklabel pos=right,
    % xtick pos = left,
    % ytick pos = left,
    % % yticklabel pos=right,
    % % enlargelimits=0.15,
    ylabel={Relative loss(\%)},
    %xlabel={BW \small{(MHz)}},
         xticklabel style={
    	%font=\small,
    	align=center,
    	xshift= 0pt,
    	yshift = 3pt,
    },
    yticklabel style={
    	%font=\small,
    	align=center,
    	xshift= 3pt,
    	yshift = 0pt,
    },
    xlabel style={
        %font=\small,
        % at={(current axis.north west)},
        % rotate=-90,
       % xshift= -10pt,
        yshift = 5pt,
    },
    ylabel style={
        %font=\small,
        % at={(current axis.north west)},
        % rotate=-90,
        %text width=2.8cm,
        align=center,
        xshift=-3pt,
        yshift = -8 pt,
    },
legend style={
	at      = {(0.9, 1)},
	font    = \normalsize,
	fill    = none,
	draw    = none,
	%anchor  = north west,
	legend cell align   = left,
	legend columns      = 3,
},
%    xlabel style={
%        font=\large,
%        % at={(current axis.north west)},
%        % rotate=-90,
%        % xshift=-1ex,
%        xshift = 0 pt,
%        yshift = 3pt,
%    },
    % symbolic x coords={att, tmo, sprint, cmcc, fi},
    % xticklabels={AT\&T, T-Mobile, Sprint, China Mobile, Google-Fi},
    % xtick=data,
    % nodes near coords,
    % nodes near coords align={vertical},
                cycle list={{myred},{myblue},{mypurple}},
    ]
    
%		\foreach \n in {1,...,3} {
%			\addplot+[boxplot, fill, draw=black] table[y index=\n] {\datatransposed};
%		}    

%\pgfplotstablegetrowsof{\datatable}
%\pgfmathtruncatemacro\TotalRows{\pgfplotsretval-1}
%\pgfplotsinvokeforeach{0,...,\TotalRows}
%{
%	\addplot+[
%	boxplot prepared from table={
%		table=\datatable,
%		row=#1,
%		lower whisker=lw,
%		upper whisker=uw,
%		lower quartile=lq,
%		upper quartile=uq,
%		median=med
%	},
%	boxplot prepared={
%		every box/.style={thick,black,solid},
%		every whisker/.style={very thin,black,solid},
%		every median/.style={very thick,blue,solid},},
%	% to get a more useful legend
%	area legend
%	]
%	coordinates {};
%	% add legend entry 
%	%\pgfplotstablegetelem{#1}{name}\of\datatable
%	%\addlegendentryexpanded{\pgfplotsretval}
%}

\pgfplotstablegetrowsof{\datatablea}
\pgfmathtruncatemacro\TotalRows{\pgfplotsretval-1}
\pgfplotsinvokeforeach{0,...,\TotalRows}
{
	\addplot+[
	boxplot prepared from table={
		table=\datatablea,
		row=#1,
		lower whisker=lw,
		upper whisker=uw,
		lower quartile=lq,
		upper quartile=uq,
		median=med,
		%draw position = 1
	},
	boxplot prepared={
		draw position=#1 * 3.5+ 1,
		%		every box/.style={thick,black,solid},
		%		every whisker/.style={very thin,black,solid},
		%		every median/.style={very thick,blue,solid},},
	every box/.style={thick,myred,solid},
	every whisker/.style={very thin,myred,solid},
	every median/.style={very thick,myred,solid},},
fill,fill opacity=0.1,
% to get a more useful legend
area legend
]
coordinates {};
add legend entry 
%\pgfplotstablegetelem{#1}{name}\of\datatable
%\addlegendentryexpanded{\pgfplotsretval}
}

\pgfplotstablegetrowsof{\datatableb}
\pgfmathtruncatemacro\TotalRows{\pgfplotsretval-1}
\pgfplotsinvokeforeach{0,...,\TotalRows}
{
\addplot+[
boxplot prepared from table={
	table=\datatableb,
	row=#1,
	lower whisker=lw,
	upper whisker=uw,
	lower quartile=lq,
	upper quartile=uq,
	median=med,
	%draw position = 1
},
boxplot prepared={
	draw position=#1 * 3.5 + 2,
	%		every box/.style={thick,black,solid},
	%		every whisker/.style={very thin,black,solid},
	%		every median/.style={very thick,blue,solid},},
every box/.style={thick,myblue,solid},
every whisker/.style={very thin,myblue,solid},
every median/.style={very thick,myblue,solid},},
fill,fill opacity=0.1,
% to get a more useful legend
area legend
]
coordinates {};
add legend entry 
%\pgfplotstablegetelem{#1}{name}\of\datatable
%\addlegendentryexpanded{\pgfplotsretval}
}

\pgfplotstablegetrowsof{\datatablec}
\pgfmathtruncatemacro\TotalRows{\pgfplotsretval-1}
\pgfplotsinvokeforeach{0,...,\TotalRows}
{
\addplot+[
boxplot prepared from table={
table=\datatablec,
row=#1,
lower whisker=lw,
upper whisker=uw,
lower quartile=lq,
upper quartile=uq,
median=med,
%draw position = 1
},
boxplot prepared={
draw position=#1 * 3.5 + 3,
%		every box/.style={thick,black,solid},
%		every whisker/.style={very thin,black,solid},
%		every median/.style={very thick,blue,solid},},
every box/.style={thick,mypurple,solid},
every whisker/.style={very thin,mypurple,solid},
every median/.style={very thick,mypurple,solid},},
fill,fill opacity=0.1,
% to get a more useful legend
area legend
]
coordinates {};
add legend entry 
%\pgfplotstablegetelem{#1}{name}\of\datatable
%\addlegendentryexpanded{\pgfplotsretval}
}

%\node[text=black] at (axis cs:2,260) {\bf 1};
%\node[text=black] at (axis cs:6,260) {\bf 2};
%\node[text=black] at (axis cs:10,260) {\bf 3};
%\node[text=black] at (axis cs:14,260) {\bf 4};
%\node[text=black] at (axis cs:18,260) {\bf 5};
%\node[text=black] at (axis cs:22,260) {\bf 6};
%\node[text=black] at (axis cs:26,260) {\bf 7};
%\node[text=black] at (axis cs:30,260) {\bf 8};
%\node[text=black] at (axis cs:34,260) {\bf 9};
%\node[text=black] at (axis cs:38,260) {\bf 10};
%\node[text=black] at (axis cs:42,260) {\bf 11};
%\node[text=black] at (axis cs:46,260) {\bf 12};
%\node[text=black] at (axis cs:50,260) {\bf 13};

\addplot[only marks,draw=myred,fill=white,mark=*,mark size=1pt,fill opacity=0.2] table[x=x,y=y] \outlierdatatablea;
\addplot[only marks,draw=myblue,fill=white,mark=*,mark size=1pt,fill opacity=0.2] table[x=x,y=y] \outlierdatatableb;
\addplot[only marks,draw=mypurple,fill=white,mark=*,mark size=1pt,fill opacity=0.2] table[x=x,y=y] \outlierdatatablec;

%\legend{\textbf{T}, \textbf{A}, \textbf{V}}

\node[] at (axis cs: 2,120) {\normalsize {\bf D1}};
\node[] at (axis cs: 5,120) {\normalsize {\bf D2}};

\addplot+[mark=none, densely dashed,gray,line width=0.5pt] coordinates {(3.75,0.0001) (3.75,300)};

%\node[] at (axis cs: 1.5,120) {\normalsize {\bf \texttt{D2}}};
%\node[] at (axis cs: 5,120) {\normalsize {\bf \texttt{D1}}};

%\legend{before, after}

%\filldraw [draw=myred, fill = myred,fill opacity=0.1, thick] (1.4,350) rectangle (2,700);
%\node[,right] at (axis cs: 2,500) {\normalsize U};
%
%\filldraw [draw=myblue, fill = myblue,fill opacity=0.1, thick] (3.4,350) rectangle (4,700);
%\node[,right] at (axis cs: 4,500) {\normalsize Others};


%\addplot+[mark=none, densely dashed,gray,line width=0.2pt] coordinates {(0,300) (4,300)};
%\node[,right] at (axis cs: 1.25, 400) {\small 300 Mbps};

% replot median in RED
%\addplot+[mark=none, very thick,solid,red] coordinates {(0.75,13.3) (1.25,13.3)};
%\addplot+[mark=none, very thick,solid,red] coordinates {(1.75,23.9) (2.25,23.9)};
%\addplot+[mark=none, very thick,solid,blue] coordinates {(2.75,165.1) (3.25,165.1)};


%\draw[gray,densely dashed,->,line width=0.2pt] (axis cs:1.25,13) -- (axis cs: 1.5,1.5);
%\node[,right] at (axis cs: 1.25,1.5) {\small 13.0};
%\draw[gray,densely dashed,->,line width=0.2pt] (axis cs:2.75,21.8) -- (axis cs: 3,6);
%\node[,right] at (axis cs: 2,6) {\small 21.8};
%\node[,right] at (axis cs: 1,300) {\small 164.5};

%\addplot+[mark=none, densely dashed,red,line width=0.2pt] coordinates {(0,13.3) (1.25,13.3)};
%\addplot+[mark=none, densely dashed,red,line width=0.2pt] coordinates {(2,23.9) (2.75,23.9)};
%\addplot+[mark=none, densely dashed,blue,line width=0.2pt] coordinates {(2.25,165.1) (3.5,165.1)};
%
%\draw[red,densely dashed,line width=0.2pt] (axis cs:1.25,13.3) -- (axis cs: 1.5,3);
%\node[red,right] at (axis cs: 1,2) {\small 13.3};
%\draw[red,densely dashed,line width=0.2pt] (axis cs:2.75,23.9) -- (axis cs: 3,7);
%\node[red,right] at (axis cs: 2,6) {\small 23.9};
%\draw[blue,densely dashed,line width=0.2pt] (axis cs:2.25,165.1) -- (axis cs: 1.5,300);
%\node[blue,right] at (axis cs: 1, 340) {\small 165.1};

%13
%21.8
%164.5

%\addplot+ [onlymarks,draw=black,mark=*,mark size=0.5pt,mark options={fill=black,},
%]table[x=x,y=y] \outlierdatatable;
%coordinates { 
%	(1,0)
%	(1, 100)
%	(2, 100)
%	(2, 100)
%};


\end{semilogyaxis}
\end{tikzpicture}

\end{document}

